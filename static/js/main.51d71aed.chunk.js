(this["webpackJsonpplanning-poker"]=this["webpackJsonpplanning-poker"]||[]).push([[0],{41:function(e,t,n){},42:function(e,t,n){},60:function(e,t,n){},61:function(e,t,n){"use strict";n.r(t);var c=n(3),a=n(2),o=n.n(a),r=n(31),i=n.n(r),s=(n(41),n(5)),l=n(17),u=n(6),d=(n(42),n(32)),j=n.n(d),b=n(8),m=function e(t){Object(b.a)(this,e),this.name=t,this.flipped=!1,this.value=""},p=n(14),f=n(25),h=function e(t,n,c){Object(b.a)(this,e),this.name=t,this.flipped=!1,this.players=void 0,this.players=Object(p.a)({},n,new m(c))};var v=n(21);n(52),n(62);v.a.apps.length||v.a.initializeApp({apiKey:"AIzaSyDQw8SrAqQ4yDwbMpolW574MgJf0Znwa4c",authDomain:"planning-poker-project-22.firebaseapp.com",databaseURL:"https://planning-poker-project-22-default-rtdb.firebaseio.com",projectId:"planning-poker-project-22",storageBucket:"planning-poker-project-22.appspot.com",messagingSenderId:"681283855494",appId:"1:681283855494:web:6033cb8884800c770a1d07",measurementId:"G-W2JXHCQC1R"});var O=v.a.database().ref().child("planning-poker-v2"),x=v.a.analytics(),g=n(26),y=n(64),N=n(16),R=new(function(){function e(t){Object(b.a)(this,e),this.APP_NAME=t}return Object(N.a)(e,[{key:"setAppStorage",value:function(e,t){return localStorage.setItem(this.getKey(e),JSON.stringify(t)),t}},{key:"getAppStorage",value:function(e){var t=localStorage.getItem(this.getKey(e));return t&&JSON.parse(t)}},{key:"getKey",value:function(e){return"".concat(this.APP_NAME,".").concat(e)}}]),e}())("PLANNING_POKER"),S="deviceData",w=[];function D(){return R.getAppStorage(S)}function C(e){var t=R.setAppStorage(S,e);return w.forEach((function(e){return e(t)})),t}var I={getDeviceData:D,setDeviceData:C,onChange:function(e){w.push(e)},setName:function(e){C(Object(g.a)(Object(g.a)({},D()),{},{name:e,userId:"".concat(Object(y.a)(),"_").concat(e)}))}},k=O.child("rooms");var P={createRoom:function(e){return k.once("value").then((function(t){var n=t.val()||{},c=j.a.generate();if(c in n)throw new Error("couldnt create new room b/c of id collision");var a=I.getDeviceData();if(!a)throw new Error("deviceData not defined");return new Promise((function(t,n){k.child(c).set(new h(e,a.userId,a.name),(function(e){e?n(e):t(c)}))}))}))},onRoomUpdate:function(e,t){k.child(e).on("value",(function(e){return t(e.val())}))},addRoomPlayer:function(e,t,n){k.child(e).child("players").child(t).set(new m(n))},removeRoomPlayer:function(e,t){k.child(e).child("players").child(t).remove()},updateRoomPlayer:function(e,t,n){k.child(e).child("players").child(t).update(n)},flipAllRoomCards:function(e,t){var n=t.players;Object.entries(n).forEach((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);n.value&&(n.flipped=!0)})),k.child(e).child("players").update(n)},resetAllRoomCards:function(e,t){var n=t.players;Object.entries(n).forEach((function(e){var t=Object(s.a)(e,2),n=(t[0],t[1]);n.value="",n.flipped=!1})),k.child(e).child("players").update(n)}},E=function(){var e=Object(a.useState)(""),t=Object(s.a)(e,2),n=t[0],o=t[1],r=Object(a.useState)(""),i=Object(s.a)(r,2),l=i[0],d=i[1],j=Object(u.f)();function b(e){j.push("/rooms/".concat(e))}return Object(c.jsxs)("div",{children:[Object(c.jsxs)("form",{onSubmit:function(e){e.preventDefault(),l&&b(l)},children:[Object(c.jsx)("label",{htmlFor:"roomCode",children:"Join Room:"}),Object(c.jsxs)("div",{className:"input-group mb-3",children:[Object(c.jsx)("input",{id:"roomCode",type:"text",className:"form-control",placeholder:"Room Code","aria-label":"Room Code",onChange:function(e){return d(e.target.value)}}),Object(c.jsx)("div",{className:"input-group-append",children:Object(c.jsx)("button",{className:"btn btn-outline-primary",type:"submit",id:"joinRoomButton",children:"Join Room"})})]})]}),Object(c.jsxs)("form",{onSubmit:function(e){e.preventDefault(),n&&P.createRoom(n).then((function(e){b(e)})).catch((function(e){console.log("err =",e)}))},children:[Object(c.jsx)("label",{htmlFor:"roomName",children:"Create Room:"}),Object(c.jsxs)("div",{className:"input-group mb-3",children:[Object(c.jsx)("input",{id:"roomName",type:"text",className:"form-control",placeholder:"Room Name","aria-label":"Room Name",onChange:function(e){return o(e.target.value)}}),Object(c.jsx)("div",{className:"input-group-append",children:Object(c.jsx)("button",{id:"createRoomButton",className:"btn btn-outline-secondary",type:"submit",children:"Create Room"})})]})]})]})},A=function(e){var t=e.deviceData,n=e.children,o=Object(a.useState)(!1),r=Object(s.a)(o,2),i=r[0],l=r[1],u=Object(a.useRef)(null);return Object(a.useEffect)((function(){function e(e){e.target!==u.current&&l(!1)}return window.addEventListener("click",e),function(){window.removeEventListener("click",e)}}),[]),Object(c.jsx)("div",{className:"btn-group",children:Object(c.jsxs)("div",{className:"dropdown",children:[Object(c.jsxs)("button",{ref:u,className:"btn btn-outline-secondary dropdown-toggle",type:"button",id:"profileMenuButton","aria-label":"Profile Options","data-bs-toggle":"dropdown","aria-expanded":i,onClick:function(){return l(!i)},children:["Hello ",t.name,"!"]}),Object(c.jsx)("ul",{className:"dropdown-menu ".concat(i?"show":""),style:{right:0,left:"auto"},"aria-labelledby":"profileMenuButton",children:n})]})})},M=function(e){var t=e.deviceData,n=Object(u.f)();return Object(c.jsx)("nav",{className:"navbar navbar-light bg-purpl",children:Object(c.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[Object(c.jsx)(l.b,{className:"navbar-brand",to:"/",children:"Planning Poker"}),t&&Object(c.jsx)(A,{deviceData:t,children:Object(c.jsx)("li",{children:Object(c.jsx)("button",{className:"dropdown-item",onClick:function(){I.setDeviceData(null),n.push("/")},children:"Logout"})})})]})})},F=function(e){var t=e.onSubmit,n=Object(a.useState)(""),o=Object(s.a)(n,2),r=o[0],i=o[1];return Object(c.jsxs)("div",{children:[Object(c.jsx)("div",{children:"Please enter your name:"}),Object(c.jsx)("form",{onSubmit:function(e){e.preventDefault(),""!==r&&t(r)},children:Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsx)("div",{className:"col",children:Object(c.jsx)("input",{type:"text",placeholder:"Name",id:"name",className:"form-control",value:r,onChange:function(e){i(e.target.value)}})}),Object(c.jsx)("div",{className:"col-auto",children:Object(c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})]})};function J(){var e=Object(a.useState)(I.getDeviceData()),t=Object(s.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){I.onChange((function(e){!function(e){(null===e||void 0===e?void 0:e.userId)&&x.setUserId(e.userId)}(e),c(e)}))}),[]),[n,function(e){I.setName(e)}]}n(60);var L=n(35);var _=function(e){var t,n,o=e.userId,r=e.player,i=e.onRemovePlayer,l=e.currentUser,u=Object(a.useState)(!1),d=Object(s.a)(u,2),j=d[0],b=d[1];return Object(a.useEffect)((function(){r.value&&b(!0);var e=setTimeout((function(){b(!1)}),1e3);return function(){clearTimeout(e)}}),[r.value]),Object(c.jsx)("div",{className:"col-6 col-sm-4 col-md-3 mb-3",children:Object(c.jsxs)("div",{className:"player-tile ".concat(l===o?"me":""),children:[Object(c.jsxs)("div",{className:"player-name",children:[Object(c.jsxs)("div",{children:[r.name," "]}),Object(c.jsx)("small",{children:l===o?"(you)":""}),Object(c.jsx)("div",{className:"player-remove",onClick:function(){return i(o)},children:"\u2715"})]}),Object(c.jsx)(L.a.div,{className:"player-card ".concat(j?"pulse":""," ").concat((t=r.flipped,n=r.value,n?t?"flipped":"ready":"empty")),children:Object(c.jsx)("div",{children:r.flipped?r.value:""})})]})})},B=["?","0","0.5","1","2","3","5","8","13","21"],U=function(e){var t=e.onSubmit,n=e.onExit,o=Object(a.useState)(""),r=Object(s.a)(o,2),i=r[0],l=r[1];return Object(c.jsx)("div",{className:"mb-3",children:Object(c.jsx)("form",{onSubmit:function(e){e.preventDefault(),""!==i&&t(i)},children:Object(c.jsxs)("div",{className:"form-row",children:[Object(c.jsx)("div",{className:"col-auto",children:Object(c.jsx)("button",{type:"button",className:"btn btn-danger",onClick:n,children:"Exit Room"})}),Object(c.jsx)("div",{className:"col",children:Object(c.jsxs)("select",{id:"points",className:"form-control",onChange:function(e){l(e.target.value)},children:[Object(c.jsx)("option",{value:"",children:"Pick your points"}),B.map((function(e){return Object(c.jsx)("option",{value:e,children:e},e)}))]})}),Object(c.jsx)("div",{className:"col-auto",children:Object(c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})},K=function(e){var t=e.roomId,n=e.room,o=e.deviceData,r=Object(u.f)();function i(e){e!==o.userId&&P.removeRoomPlayer(t,e)}Object(a.useEffect)((function(){P.addRoomPlayer(t,o.userId,o.name)}),[t,o]);var l=Object.entries(n.players).sort((function(e,t){var n=Object(s.a)(e,1)[0];Object(s.a)(t,1)[0];return n===o.userId?-1:1})),d=function(e){var t=Object.entries(e).map((function(e){var t=Object(s.a)(e,2);return t[0],t[1]})).filter((function(e){return e.flipped})).map((function(e){return Number(e.value)}));if(0===t.length)return"";var n=f.mode(t);return n instanceof Array?n.sort().join(","):n instanceof Set?Array.from(n).sort().join(","):n.toString()}(n.players),j=function(e){var t=Object.entries(e).map((function(e){var t=Object(s.a)(e,2);return t[0],t[1]})).filter((function(e){return e.flipped})).map((function(e){return Number(e.value)}));return 0===t.length?"":f.mean(t).toString()}(n.players);return Object(c.jsxs)("div",{children:[Object(c.jsxs)("div",{children:[Object(c.jsx)("strong",{children:"You're in room:"})," ",n.name]}),Object(c.jsxs)("div",{className:"mb-2",children:[Object(c.jsx)("strong",{children:"Room code:"})," ",t]}),Object(c.jsx)("div",{className:"mb-2 poker-info",children:Object(c.jsx)(U,{onSubmit:function(e){P.updateRoomPlayer(t,o.userId,{value:e,flipped:!1})},onExit:function(){r.push("/")}})}),Object(c.jsxs)("div",{className:"text-center mb-3",children:["Mode: ",d," | Mean : ",j]}),Object(c.jsx)("div",{className:"row",children:l.map((function(e){var t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(c.jsx)(_,{userId:n,currentUser:o.userId,player:a,onRemovePlayer:i},n)}))}),Object(c.jsxs)("div",{className:"mb-3 text-center poker-footer",children:[Object(c.jsx)("button",{type:"button",className:"btn btn-success mr-3",onClick:function(){P.flipAllRoomCards(t,n)},children:"Flip all cards"}),Object(c.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:function(){P.resetAllRoomCards(t,n)},children:"Reset"})]})]})},T=function(e){var t=e.deviceData,n=Object(u.g)().roomId,o=Object(a.useState)(null),r=Object(s.a)(o,2),i=r[0],l=r[1],d=Object(a.useState)(!0),j=Object(s.a)(d,2),b=j[0],m=j[1],p=Object(a.useState)(!1),f=Object(s.a)(p,2),h=f[0],v=f[1];return Object(a.useEffect)((function(){m(!0),P.onRoomUpdate(n,(function(e){m(!1),console.log("newRoomData =",e),e?(v(!1),l(e),function(e,t){try{x.logEvent("page_view",{page_title:"Room ".concat(t.name),page_location:window.location.href,page_path:"/#/rooms/".concat(e)})}catch(n){}}(n,e)):v(!0)}))}),[n]),b?Object(c.jsx)("div",{children:"Loading..."}):h||!i?Object(c.jsx)("div",{children:"Room Not Found"}):Object(c.jsx)(K,{roomId:n,room:i,deviceData:t})};var Q=function(){var e=J(),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(c.jsxs)(l.a,{children:[Object(c.jsx)(M,{deviceData:n}),Object(c.jsx)("div",{className:"container mt-3 mb-3",children:n?Object(c.jsxs)(u.c,{children:[Object(c.jsx)(u.a,{exact:!0,path:"/",children:Object(c.jsx)(E,{})}),Object(c.jsx)(u.a,{path:"/rooms/:roomId",children:Object(c.jsx)(T,{deviceData:n})})]}):Object(c.jsx)(F,{onSubmit:a})})]})},z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,65)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),o(e),r(e)}))};i.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(Q,{})}),document.getElementById("root")),z()}},[[61,1,2]]]);
//# sourceMappingURL=main.51d71aed.chunk.js.map